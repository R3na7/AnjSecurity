{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">{{ t('tests') }}</h2>
        <small class="text-muted">{{ algorithm.info.get_name(lang) }}</small>
    </div>
    {% if current_user.is_admin %}
    <a class="btn btn-primary" href="{{ url_for('create_test', category=category, slug=algorithm.info.slug) }}">{{ 'Создать тест' if lang == 'ru' else 'Create test' }}</a>
    {% endif %}
</div>
{% if tests_data %}
    <div class="row g-3">
    {% for item in tests_data %}
        {% set test = item.test %}
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column">
                    {% set title = test.display_title(lang) %}
                    <h5 class="card-title">{{ title if title else ('Без названия' if lang == 'ru' else 'Untitled test') }}</h5>
                    <p class="card-text text-muted mb-2">{{ 'Максимум баллов' if lang == 'ru' else 'Maximum score' }}: {{ test.total_points }} · {{ 'Лимит времени' if lang == 'ru' else 'Time limit' }}: {{ (test.time_limit_seconds // 60) }} {{ 'мин' if lang == 'ru' else 'min' }}</p>
                    {% set latest = item.latest_result %}
                    {% if latest %}
                    <p class="card-text">{{ 'Последний результат' if lang == 'ru' else 'Last result' }}: {{ latest.score_points }}/{{ latest.max_points }}</p>
                    {% endif %}
                    <p class="card-text">{{ 'Осталось попыток' if lang == 'ru' else 'Attempts left' }}: {{ item.attempts_left }}</p>
                    <div class="mt-auto pt-2 d-flex flex-column gap-2">
                        {% if item.attempts_left > 0 %}
                        <a class="btn btn-outline-success" href="{{ url_for('take_test', category=category, slug=algorithm.info.slug, test_id=test.id) }}">{{ 'Пройти тест' if lang == 'ru' else 'Take test' }}</a>
                        {% else %}
                        <button class="btn btn-outline-secondary" disabled>{{ 'Попытки исчерпаны' if lang == 'ru' else 'Attempts exhausted' }}</button>
                        {% endif %}
                        {% if current_user.is_admin %}
                        <a class="btn btn-link" href="{{ url_for('add_test_question', category=category, slug=algorithm.info.slug, test_id=test.id) }}">{{ 'Добавить вопрос' if lang == 'ru' else 'Add question' }}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>
{% else %}
<div class="alert alert-info">{{ 'Тесты для этого алгоритма ещё не добавлены.' if lang == 'ru' else 'No tests have been added for this algorithm yet.' }}</div>
{% endif %}
{% endblock %}
